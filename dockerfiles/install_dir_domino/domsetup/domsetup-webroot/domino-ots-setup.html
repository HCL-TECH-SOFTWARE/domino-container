<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="assets/bootstrap.min.css">
    <title>HCL Domino Server Configuration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #dropZone {
            width: 350px;
            height: 120px;
            border: 2px dashed #007BFF;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin: 20px auto;
            padding: 10px;
            cursor: pointer;
            color: #007BFF;
        }
        #dropZone.highlight {
            background-color: #f0f8ff;
        }
    </style>
</head>
<body>

    <br>
    <br>
    <img src="assets/domsetup-logo.svg" style="max-height: 100px;" class="" alt="HCL Domino Server">
    <br>
    <br>
    <h3>Domino First / Additional Server Setup</h3>
    <br>

    <!-- Drag-and-Drop Zone -->
    <div id="dropZone">Drag & drop a file or click to select</div>
    <br>
    <p>Upload a Domino server OTS JSON configuration file.</p>
    <p>Or perform a form based first server Domino setup.</p>
    <br>

    <!-- Hidden File Input -->
    <input type="file" id="fileInput" style="display: none;">

    <!-- Upload Button -->
    <button class="btn btn-outline-primary" type="button" id="uploadButton">Upload JSON file</button>
    &nbsp
    <a href="/domino-setup.html" class="btn btn-outline-primary">First server setup</a>

    <br>
    <br>
    <p id="status"></p>
    <br>

    <script>
        const dropZone = document.getElementById("dropZone");
        const fileInput = document.getElementById("fileInput");
        const uploadButton = document.getElementById("uploadButton");
        const status = document.getElementById("status");

        let selectedFile = null;

        // Open file dialog when clicking dropZone
        dropZone.addEventListener("click", () => fileInput.click());

        // Handle file selection
        fileInput.addEventListener("change", (event) => handleFile(event.target.files[0]));

        // Drag & Drop events
        dropZone.addEventListener("dragover", (event) => {
            event.preventDefault();
            dropZone.classList.add("highlight");
        });

        dropZone.addEventListener("dragleave", () => dropZone.classList.remove("highlight"));

        dropZone.addEventListener("drop", (event) => {
            event.preventDefault();
            dropZone.classList.remove("highlight");
            handleFile(event.dataTransfer.files[0]);
        });

        function handleFile(file) {
            if (!file) return;
            selectedFile = file;
            dropZone.textContent = `Selected: ${file.name}`;
            status.textContent = "";
        }

        uploadButton.addEventListener("click", async () => {
            if (!selectedFile) {
                status.textContent = "No file selected!";
                return;
            }

            status.textContent = "Uploading...";

const uploadUrl = "/upload";

try {
    const response = await fetch(uploadUrl, {
        method: "POST",
        headers: {
            // Use the file's MIME type if available; fall back to generic binary
            "Content-Type": selectedFile.type || "application/octet-stream",
            // Optional but handy if your server wants the original filename
            "Content-Disposition": `attachment; filename="${selectedFile.name}"`
        },
        // Send the raw bytes (Blob/File is fine here)
        body: selectedFile
    });

    if (!response.ok) {
        const errorText = await response.text();
        throw new Error(errorText);
    }

    status.textContent = "Upload successful!";
    setTimeout(() => {
        window.location.href = "/completed.html";
    }, 2000);

} catch (error) {
    console.error("Upload error:", error);
    status.textContent = `Configuration failed: ${error.message}`;
}



        });
    </script>

</body>
</html>
